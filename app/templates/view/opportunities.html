{% extends "template.html" %}

{% set active_page = active_page|default('opportunities') -%}

{% block title %}Opportunities{% endblock %}

{% set sort_options = [
  ('dateposted-desc', 'Date Created (Newest - Oldest)'),
  ('dateposted-asc', 'Date Created (Oldest - Newest)'),
  ('deadline-desc', 'Deadline (Least Recent - Most Recent)'),
  ('deadline-asc', 'Deadline (Most Recent - Least Recent)'),
  ('cost-asc', 'Price ($ - $$$$)'),
  ('cost-desc', 'Price ($$$$ - $)')
  ] %}

{% set grades = [
  ('9', 'Freshman'),
  ('10', 'Sophomore'),
  ('11', 'Junior'),
  ('12', 'Senior')
  ] %}

{% block body %}

{% if body %}
{{ body }}
{% endif %}

<!-- SIDENAV -->
<div class="sidenav">
  <form class="w-100" action="/opportunities" method="POST">
    <h5> <b> Refine Results </b> </h5> <hr>
    <input style="margin-bottom: 2vh;" class="form-control" type="search" name="search" placeholder="Search" aria-label="Search"
      {% if body %}
      value="{{ body['search'] }}"
      {% endif %}
    >
    <select style="margin-bottom: 2vh;" class="form-control" id="sort" name="sort">
      {% if body %}
        {% for value, display in sort_options %}
          <option value="{{ value }}"
            {% if body['sort'] == value %}
            selected
            {% endif %}
          >{{ display }}</option>
        {% endfor %}
      {% else %}
        {% for value, display in sort_options %}
          <option value="{{ value }}">{{ display }}</option>
        {% endfor %}
      {% endif %}
    </select>

    <button style="margin-bottom: 2vh;" class="btn btn-primary btn-sm form-control" type="button" data-toggle="collapse" data-target="#collapse-filters"
      aria-expanded="false" aria-controls="collapse-filters">
      Filter &#9662;
    </button>
    <br>
    <div class="collapse" id="collapse-filters" style="margin-bottom: 2vh;">
    <div class="card card-body">
    <div class="overflow-auto">
      <b> Field </b>
      <br>
      {% if body %}
        {% for field in fields %}
          <input type="checkbox" name="field-{{ field }}" value="{{ field }}"
            {% if field in body['filters']['field'] %}
              checked
            {% endif %}
          >
          <label>{{field}}</label><br>
        {% endfor %}
      {% else %}
        {% for field in fields %}
          <input type="checkbox" name="field-{{ field }}" value="{{ field }}">
          <label>{{field}}</label><br>
        {% endfor %}
      {% endif %}
      <br>
      <label for="minPrice"><b> Maximum Price </b> </label> <br>
      <div style="width: 16vw;" class="input-group">
        <div class="input-group-prepend">
          <div class="input-group-text" id="btnGroupAddon">$</div>
        </div>
        <input type="number" class="form-control" name="maximum-cost" min=0 step=0.01 placeholder="Enter price"
          {% if body %}
            {% if body['filters']['maximum-cost'] != None %}
              value="{{ body['filters']['maximum-cost'] }}"
            {% endif %}
          {% endif %}
        >
      </div>
      <br>

      <b> Grade </b> <br>
      {% for value, display in grades %}
        <input type="checkbox" name="grade-{{ value }}" value="{{ value }}">
        <label>{{ display }}</label><br>
      {% endfor %}
      <br>
      <b> Gender </b> <br>
      {% for value, display in genders %}
        <input type="checkbox" name="gender-{{ value }}" value="{{ value }}">
        <label> {{ display }}</label><br>
      {% endfor %}
      </div>
      </div>
      </div>
      <button class="btn btn-outline-primary btn-sm w-100" type="submit">Show Results</button>
  </form>
</div>

<!-- OPPORTUNTIIES (right) -->
<div class="opportunities">
  {% for opp in opportunityList %}
  <div class="opp-block">
    <br>
    <a href="/opportunities/{{ opp.opportunityID }}"><h3>{{ opp.title }}</a> &nbsp;
    <!-- field -->
      {% if opp.field %}
      <a class="btn btn-primary btn-sm" href="/opportunities">&nbsp;  {{ opp.field }} &nbsp; </a> &nbsp;
      {% endif %}
    </h3></a>
    <!-- date -->
    {% if date[opp.opportunityID][0] or date[opp.opportunityID][1] %}
    <span>
      {% if date[opp.opportunityID][0] %}
      {{ date[opp.opportunityID][0] }}
      {% endif %}
      {% if date[opp.opportunityID][1] %}
      - {{ date[opp.opportunityID][1] }}
      {% endif %}
    {% endif %}

    {% if date[opp.opportunityID][2] %}
    <br>
    <b>DEADLINE: {{ date[opp.opportunityID][2] }} </b>
    {% endif %}

    <br>
    <hr>
    </span>
    <!-- location -->
    <p><b>{{ opp.location }}</b></p>

    <!-- description -->
    <p>{{ opp.description }}</p>
    <!-- links -->
    {% for link in opp.links %}
    <a href="{{ link }}">{{ link }}</a> <br>
    {% endfor %}

    <hr>

    <!-- tags -->
    <div class="tag-block">
      <!-- gender -->
      {% if opp.gender %}
      <a class="btn btn-primary btn-sm" href="/opportunities">&nbsp; {{ opp.gender }} &nbsp; </a> &nbsp;
      {% endif %}

      <!-- cost (if free) -->
      {% if opp.cost == 0 %}
      <a class="btn btn-primary btn-sm" href="/opportunities">&nbsp; free &nbsp;</a> &nbsp;
      {% endif %}

      <!-- grades -->
      {% for grade in opp.grades %}
      {% if grade == 9 %}
      <a class="btn btn-primary btn-sm" href="/opportunities">&nbsp; freshmen &nbsp; </a> &nbsp;
      {% elif grade == 10 %}
      <a class="btn btn-primary btn-sm" href="/opportunities">&nbsp; sophomores &nbsp; </a> &nbsp;
      {% elif grade == 11 %}
      <a class="btn btn-primary btn-sm" href="/opportunities">&nbsp; juniors &nbsp; </a> &nbsp;
      {% elif grade == 12 %}
      <a class="btn btn-primary btn-sm" href="/opportunities">&nbsp; seniors &nbsp; </a> &nbsp;
      {% endif %}
      {% endfor %}

      <a style="float: right; font-size: 20px" class="text-secondary star" href="/opportunities"><i class="fa fa-star" aria-hidden="true"></i></a>
    </div>


    <br>
  </div>
  {% endfor %}
</div>

{% endblock %}
